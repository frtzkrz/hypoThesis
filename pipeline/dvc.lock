schema: '2.0'
stages:
  join:
    cmd: "lyscripts data join --inputs data/2021-usz-oropharynx.csv data/2021-clb-oropharynx.csv\
      \ --output data/joined.csv\n"
    deps:
    - path: data/2021-clb-oropharynx.csv
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: data/2021-usz-oropharynx.csv
      md5: 4c62057de32538d2274eaf7f2af0c759
      size: 159482
    outs:
    - path: data/joined.csv
      md5: 7992f871b1be0f226a516418a7531892
      size: 307977
  enhance:
    cmd: "lyscripts data enhance data/joined.csv data/enhanced.csv --modalities CT\
      \ MRI PET FNA diagnostic_consensus pathology pCT\n"
    deps:
    - path: data/joined.csv
      md5: 7992f871b1be0f226a516418a7531892
      size: 307977
    params:
      params.yaml:
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
    outs:
    - path: data/enhanced.csv
      md5: 870702142deb29ac46002296ba6d1225
      size: 375364
  clean:
    cmd: lyscripts data clean data/enhanced.csv data/cleaned.csv
    deps:
    - path: data/enhanced.csv
      md5: 870702142deb29ac46002296ba6d1225
      size: 375364
    params:
      params.yaml:
        model.class: Unilateral
    outs:
    - path: data/cleaned.csv
      md5: 5c2b261b840a237ad630c450ec0d9ae4
      size: 155737
  sampling:
    cmd: "lyscripts sample data/cleaned.csv models/samples.hdf5 --plots plots/sampling\
      \ --pools 0 --ti --modalities max_llh\n"
    deps:
    - path: data/cleaned.csv
      md5: 5c2b261b840a237ad630c450ec0d9ae4
      size: 155737
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - III
            III:
            - IV
            IV: []
            V: []
            VII: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: Unilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 20
          thin_by: 10
          temp_schedule:
          - 0.0
          - 1.316872427983538e-06
          - 4.2139917695473246e-05
          - 0.0003200000000000001
          - 0.0013484773662551439
          - 0.004115226337448558
          - 0.010240000000000003
          - 0.022132674897119342
          - 0.043151275720164604
          - 0.07775999999999998
          - 0.13168724279835387
          - 0.21208362139917689
          - 0.3276800000000001
          - 0.48894551440329226
          - 0.708245596707819
          - 1.0
          kwargs:
            max_steps: 20000
            check_interval: 100
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: models/samples.hdf5
      md5: b314e1668e0650671f4b65b931871211
      size: 38190520
    - path: plots/sampling/accept_rates.csv
      md5: 3392ab60b85ae61836adb34ff409bcbc
      size: 611
    - path: plots/sampling/acor_times.csv
      md5: 0ef014f1199e153daaada68b7eb65e1f
      size: 605
  predict-risks:
    cmd: "lyscripts predict risks models/samples.hdf5 models/risks.hdf5\n"
    deps:
    - path: models/samples.hdf5
      md5: cf0603eb71eb87010494a1629f3c78ea
      size: 4839888
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        risks:
        - name: contra/III/N0/late/ext
          involvement:
            contra:
              III: true
          given_diagnosis:
            ipsi:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
          midline_extension: true
        - name: contra/III/ipsi-IIandIII/late/noext
          involvement:
            contra:
              III: true
          given_diagnosis:
            ipsi:
              I: false
              II: true
              III: true
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
          midline_extension: false
        - name: contra/III/ipsi-IIandIII/late/ext
          involvement:
            contra:
              III: true
          given_diagnosis:
            ipsi:
              I: false
              II: true
              III: true
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
          midline_extension: true
    outs:
    - path: models/risks.hdf5
      md5: 482530636158d86338279d278b63ae87
      size: 470280
  evaluate:
    cmd: "lyscripts evaluate data/cleaned.csv models/samples.hdf5 --metrics metrics.json\
      \ --plots plots/ti/accuracies.csv\n"
    deps:
    - path: data/cleaned.csv
      md5: 5c2b261b840a237ad630c450ec0d9ae4
      size: 155737
    - path: models/samples.hdf5
      md5: b314e1668e0650671f4b65b931871211
      size: 38190520
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - III
            III:
            - IV
            IV: []
            V: []
            VII: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: Unilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 20
          thin_by: 10
          temp_schedule:
          - 0.0
          - 1.316872427983538e-06
          - 4.2139917695473246e-05
          - 0.0003200000000000001
          - 0.0013484773662551439
          - 0.004115226337448558
          - 0.010240000000000003
          - 0.022132674897119342
          - 0.043151275720164604
          - 0.07775999999999998
          - 0.13168724279835387
          - 0.21208362139917689
          - 0.3276800000000001
          - 0.48894551440329226
          - 0.708245596707819
          - 1.0
          kwargs:
            max_steps: 20000
            check_interval: 100
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: metrics.json
      md5: ae7394fe35c6b2b7669081cbde141485
      size: 159
    - path: plots/ti/accuracies.csv
      md5: 92a3de2abe595e59338e3e9070b4cf19
      size: 922
  predict-prevalences:
    cmd: "lyscripts predict prevalences models/samples.hdf5 data/cleaned.csv models/prevalences.hdf5\n"
    deps:
    - path: data/cleaned.csv
      md5: 4c6ec4376c1d6ca3814a17a61305c89b
      size: 300071
    - path: models/samples.hdf5
      md5: cf0603eb71eb87010494a1629f3c78ea
      size: 4839888
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        prevalences:
        - name: ipsi/IInotI/early
          pattern:
            ipsi:
              I: false
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: ipsi/IInotI/late
          pattern:
            ipsi:
              I: false
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: ipsi/IIandIII/early
          pattern:
            ipsi:
              II: true
              III: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: ipsi/IIandIII/late
          pattern:
            ipsi:
              II: true
              III: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
    outs:
    - path: models/prevalences.hdf5
      md5: c0bef3861c2871034bcf3fd4de248e6e
      size: 619656
  plot-corner:
    cmd: "lyscripts plot corner models/samples.hdf5 plots/corner.png\n"
    deps:
    - path: models/samples.hdf5
      md5: b314e1668e0650671f4b65b931871211
      size: 38190520
    outs:
    - path: plots/corner.png
      md5: 635ef3e2ec9d93fb04c91f4d28313b3a
      size: 816117
    - path: plots/corner.svg
      md5: 726b61c695d3b664c32cb1be91e26b4c
      size: 3520303
