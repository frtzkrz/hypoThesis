schema: '2.0'
stages:
  join:
    cmd: "lyscripts join --inputs data/2021-usz-oropharynx.csv data/2021-clb-oropharynx.csv\
      \ --output data/joined.csv\n"
    deps:
    - path: data/2021-clb-oropharynx.csv
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: data/2021-usz-oropharynx.csv
      md5: 4c62057de32538d2274eaf7f2af0c759
      size: 159482
    outs:
    - path: data/joined.csv
      md5: 7992f871b1be0f226a516418a7531892
      size: 307977
  enhance:
    cmd: "lyscripts enhance data/joined.csv data/enhanced.csv --modalities 'CT' 'MRI'\
      \ 'PET' 'FNA' 'diagnostic_consensus' 'pathology' 'pCT'\n"
    deps:
    - path: data/joined.csv
      md5: 7992f871b1be0f226a516418a7531892
      size: 307977
    params:
      params.yaml:
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
    outs:
    - path: data/enhanced.csv
      md5: 053e113111dc64710916e5446d3d6ba6
      size: 375364
  clean:
    cmd: lyscripts clean data/enhanced.csv data/cleaned.csv
    deps:
    - path: data/enhanced.csv
      md5: 053e113111dc64710916e5446d3d6ba6
      size: 375364
    params:
      params.yaml:
        model.class: Unilateral
    outs:
    - path: data/cleaned.csv
      md5: e275605eda82421e85d10dbd68a26609
      size: 155737
  sampling:
    cmd: "lyscripts sample data/cleaned.csv models/samples.hdf5 --plots plots/sampling\
      \ --pools 0 --modalities 'max_llh'\n"
    deps:
    - path: data/cleaned.csv
      md5: e275605eda82421e85d10dbd68a26609
      size: 155737
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: Unilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 50
          thin_by: 5
          temp_schedule:
          - 0.0
          - 1.316872427983538e-06
          - 4.2139917695473246e-05
          - 0.0003200000000000001
          - 0.0013484773662551439
          - 0.004115226337448558
          - 0.010240000000000003
          - 0.022132674897119342
          - 0.043151275720164604
          - 0.07775999999999998
          - 0.13168724279835387
          - 0.21208362139917689
          - 0.3276800000000001
          - 0.48894551440329226
          - 0.708245596707819
          - 1.0
          kwargs:
            max_steps: 10000
            check_interval: 100
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: models/samples.hdf5
      md5: ed996eda1cc8c897170123320dbe0bc2
      size: 3527152
    - path: plots/sampling/accept_rates.csv
      md5: d47e62d6ee71ed3cf51a92e09331a1a7
      size: 1200
    - path: plots/sampling/acor_times.csv
      md5: 7d196427a85a09d6e689dd1b65751263
      size: 1204
  predict-risks:
    cmd: "lyscripts predict risks models/samples.hdf5 models/risks.hdf5\n"
    deps:
    - path: models/samples.hdf5
      md5: ed996eda1cc8c897170123320dbe0bc2
      size: 3527152
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: Unilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        risks:
        - name: ipsi-III/involved-II/early
          involvement:
            ipsi:
              II:
              III: true
          given_diagnosis:
            ipsi:
              II: true
              III: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: early
          invert: false
        - name: ipsi-III/involved-II/late
          involvement:
            ipsi:
              II:
              III: true
          given_diagnosis:
            ipsi:
              II: true
              III: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
          invert: false
    outs:
    - path: models/risks.hdf5
      md5: 334321addc3a83669da808ea0b63d6ff
      size: 185608
  evaluate:
    cmd: "lyscripts evaluate data/cleaned.csv models/samples.hdf5 --metrics metrics.json\n"
    deps:
    - path: data/cleaned.csv
      md5: e275605eda82421e85d10dbd68a26609
      size: 155737
    - path: models/samples.hdf5
      md5: ed996eda1cc8c897170123320dbe0bc2
      size: 3527152
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: Unilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 50
          thin_by: 5
          temp_schedule:
          - 0.0
          - 1.316872427983538e-06
          - 4.2139917695473246e-05
          - 0.0003200000000000001
          - 0.0013484773662551439
          - 0.004115226337448558
          - 0.010240000000000003
          - 0.022132674897119342
          - 0.043151275720164604
          - 0.07775999999999998
          - 0.13168724279835387
          - 0.21208362139917689
          - 0.3276800000000001
          - 0.48894551440329226
          - 0.708245596707819
          - 1.0
          kwargs:
            max_steps: 10000
            check_interval: 100
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: metrics.json
      md5: 682a511fdf7db147919be894d77965d9
      size: 91
  predict-prevalences:
    cmd: "lyscripts predict prevalences models/samples.hdf5 data/cleaned.csv models/prevalences.hdf5\n"
    deps:
    - path: data/cleaned.csv
      md5: e275605eda82421e85d10dbd68a26609
      size: 155737
    - path: models/samples.hdf5
      md5: ed996eda1cc8c897170123320dbe0bc2
      size: 3527152
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: Unilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        prevalences:
        - name: I/early
          pattern:
            ipsi:
              I: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: InotII/early
          pattern:
            ipsi:
              I: true
              II: false
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: IandII/early
          pattern:
            ipsi:
              I: true
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: II/early
          pattern:
            ipsi:
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: IInotI/early
          pattern:
            ipsi:
              I: false
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: III/early
          pattern:
            ipsi:
              III: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: V/early
          pattern:
            ipsi:
              V: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: VandIII/early
          pattern:
            ipsi:
              III: true
              V: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: VnotIII/early
          pattern:
            ipsi:
              III: false
              V: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: I/late
          pattern:
            ipsi:
              I: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: InotII/late
          pattern:
            ipsi:
              I: true
              II: false
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: IandII/late
          pattern:
            ipsi:
              I: true
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: II/late
          pattern:
            ipsi:
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: IInotI/late
          pattern:
            ipsi:
              I: false
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: III/late
          pattern:
            ipsi:
              III: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: V/late
          pattern:
            ipsi:
              V: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: VandIII/late
          pattern:
            ipsi:
              III: true
              V: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: VnotIII/late
          pattern:
            ipsi:
              III: false
              V: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
    outs:
    - path: models/prevalences.hdf5
      md5: cb8611b9d34eb0945f869274355bc886
      size: 1755008
  plot-corner:
    cmd: "lyscripts plot corner models/samples.hdf5 plots/corner.png\n"
    deps:
    - path: models/samples.hdf5
      md5: ed996eda1cc8c897170123320dbe0bc2
      size: 3527152
    outs:
    - path: plots/corner.png
      md5: 02d5eddb3e050c204d91ad3cad0b395e
      size: 7578110
    - path: plots/corner.svg
      md5: a6fef23bf9c846bf94ad229d22c46380
      size: 7056988
