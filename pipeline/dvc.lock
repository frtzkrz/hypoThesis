schema: '2.0'
stages:
  join:
    cmd: "lyscripts join --inputs data/2021-usz-oropharynx.csv data/2021-clb-oropharynx.csv\
      \ --output data/joined.csv\n"
    deps:
    - path: data/2021-clb-oropharynx.csv
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: data/2021-usz-oropharynx.csv
      md5: 4c62057de32538d2274eaf7f2af0c759
      size: 159482
    outs:
    - path: data/joined.csv
      md5: 7992f871b1be0f226a516418a7531892
      size: 307977
  enhance:
    cmd: "lyscripts enhance data/joined.csv data/enhanced.csv --modalities 'CT' 'MRI'\
      \ 'PET' 'FNA' 'diagnostic_consensus' 'pathology' 'pCT'\n"
    deps:
    - path: data/joined.csv
      md5: 7992f871b1be0f226a516418a7531892
      size: 307977
    params:
      params.yaml:
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
    outs:
    - path: data/enhanced.csv
      md5: 053e113111dc64710916e5446d3d6ba6
      size: 375364
  clean:
    cmd: lyscripts clean data/enhanced.csv data/cleaned.csv
    deps:
    - path: data/enhanced.csv
      md5: 053e113111dc64710916e5446d3d6ba6
      size: 375364
    params:
      params.yaml:
        model.class: MidlineBilateral
    outs:
    - path: data/cleaned.csv
      md5: 4c6ec4376c1d6ca3814a17a61305c89b
      size: 300071
  sampling:
    cmd: "lyscripts sample data/cleaned.csv models/samples.hdf5 --plots plots/sampling\
      \ --pools 0 --modalities 'max_llh'\n"
    deps:
    - path: data/cleaned.csv
      md5: 4c6ec4376c1d6ca3814a17a61305c89b
      size: 300071
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 50
          thin_by: 5
          kwargs:
            max_steps: 20000
            check_interval: 100
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: models/samples.hdf5
      md5: cf0603eb71eb87010494a1629f3c78ea
      size: 4839888
    - path: plots/sampling/accept_rates.csv
      md5: 0e4dd68f06be463c61d70393a1b69e7c
      size: 3158
    - path: plots/sampling/acor_times.csv
      md5: 9f6dbcd885460db88bdb533101390c95
      size: 3193
  predict-risks:
    cmd: "lyscripts predict risks models/samples.hdf5 models/risks.hdf5\n"
    deps:
    - path: models/samples.hdf5
      md5: cf0603eb71eb87010494a1629f3c78ea
      size: 4839888
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        risks:
        - name: ipsi-V/N0/early
          involvement:
            ipsi:
              V: true
          given_diagnosis:
            ipsi:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: early
        - name: ipsi-V/N0/late
          involvement:
            ipsi:
              V: true
          given_diagnosis:
            ipsi:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
        - name: ipsi-V/ipsi-II/early
          involvement:
            ipsi:
              V: true
          given_diagnosis:
            ipsi:
              I: false
              II: true
              III: false
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: early
        - name: ipsi-V/ipsi-II/late
          involvement:
            ipsi:
              V: true
          given_diagnosis:
            ipsi:
              I: false
              II: true
              III: false
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
        - name: ipsi-V/ipsi-IIandIII/late
          involvement:
            ipsi:
              V: true
          given_diagnosis:
            ipsi:
              I: false
              II: true
              III: true
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
        - name: ipsi-V/ipsi-IIandIIIandIV/late
          involvement:
            ipsi:
              V: true
          given_diagnosis:
            ipsi:
              I: false
              II: true
              III: true
              IV: true
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
    outs:
    - path: models/risks.hdf5
      md5: 05404c862050bc803fc45aee8a590c90
      size: 925704
  evaluate:
    cmd: "lyscripts evaluate data/cleaned.csv models/samples.hdf5 --metrics metrics.json\n"
    deps:
    - path: data/cleaned.csv
      md5: 4c6ec4376c1d6ca3814a17a61305c89b
      size: 300071
    - path: models/samples.hdf5
      md5: cf0603eb71eb87010494a1629f3c78ea
      size: 4839888
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 50
          thin_by: 5
          kwargs:
            max_steps: 20000
            check_interval: 100
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: metrics.json
      md5: 9a71a3a0152ef8617045600221edef4b
      size: 92
  predict-prevalences:
    cmd: "lyscripts predict prevalences models/samples.hdf5 data/cleaned.csv models/prevalences.hdf5\n"
    deps:
    - path: data/cleaned.csv
      md5: 4c6ec4376c1d6ca3814a17a61305c89b
      size: 300071
    - path: models/samples.hdf5
      md5: cf0603eb71eb87010494a1629f3c78ea
      size: 4839888
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        prevalences: []
    outs:
    - path: models/prevalences.hdf5
      md5: 6781e0baec8d65b9a95a3e879a5098d1
      size: 800
  plot-corner:
    cmd: "lyscripts plot corner models/samples.hdf5 plots/corner.png\n"
    deps:
    - path: models/samples.hdf5
      md5: cf0603eb71eb87010494a1629f3c78ea
      size: 4839888
    outs:
    - path: plots/corner.png
      md5: 255008c8782b2a8859a71264ebf88e23
      size: 24799366
    - path: plots/corner.svg
      md5: ff4f9db33b511a7d5526582fedc7babd
      size: 18192538
